--
-- TOC entry 283 (class 1259 OID 30012)
-- Name: bookmarks; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.bookmarks (
    id bigint NOT NULL,
    user_id bigint NOT NULL,
    coffee_id bigint NOT NULL
);


ALTER TABLE public.bookmarks OWNER TO postgres;

--
-- TOC entry 264 (class 1259 OID 29188)
-- Name: brand; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.brand (
    id bigint NOT NULL,
    name text NOT NULL
);


ALTER TABLE public.brand OWNER TO postgres;

--
-- TOC entry 265 (class 1259 OID 29199)
-- Name: brand_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.brand ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.brand_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 266 (class 1259 OID 29206)
-- Name: coffee; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.coffee (
    id bigint NOT NULL,
    name text NOT NULL,
    description text NOT NULL,
    image_file text,
    brand bigint
);


ALTER TABLE public.coffee OWNER TO postgres;

--
-- TOC entry 267 (class 1259 OID 29218)
-- Name: coffee_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.coffee ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.coffee_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 268 (class 1259 OID 29225)
-- Name: coffee_tag; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.coffee_tag (
    id bigint NOT NULL,
    tag_id bigint NOT NULL,
    coffee_id bigint NOT NULL
);


ALTER TABLE public.coffee_tag OWNER TO postgres;

--
-- TOC entry 269 (class 1259 OID 29234)
-- Name: coffee_tag_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.coffee_tag ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.coffee_tag_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 270 (class 1259 OID 29241)
-- Name: coffee_view; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.coffee_view AS
SELECT
    NULL::text AS name,
    NULL::text AS description,
    NULL::text AS image_file,
    NULL::numeric AS rating,
    NULL::bigint AS id,
    NULL::bigint AS brand,
    NULL::bigint AS review_count;


ALTER TABLE public.coffee_view OWNER TO postgres;

--
-- TOC entry 271 (class 1259 OID 29251)
-- Name: rating; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.rating (
    id bigint NOT NULL,
    rated_by bigint NOT NULL,
    rated_coffee bigint NOT NULL,
    grade smallint NOT NULL
);


ALTER TABLE public.rating OWNER TO postgres;

--
-- TOC entry 272 (class 1259 OID 29260)
-- Name: rating_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.rating ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.rating_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 273 (class 1259 OID 29267)
-- Name: roles; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.roles (
    id bigint NOT NULL,
    name text NOT NULL
);


ALTER TABLE public.roles OWNER TO postgres;

--
-- TOC entry 274 (class 1259 OID 29278)
-- Name: roles_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.roles ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.roles_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 284 (class 1259 OID 30015)
-- Name: saved_products_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.bookmarks ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.saved_products_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 275 (class 1259 OID 29285)
-- Name: tag; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.tag (
    id bigint NOT NULL,
    name text NOT NULL
);


ALTER TABLE public.tag OWNER TO postgres;

--
-- TOC entry 285 (class 1259 OID 30041)
-- Name: tag_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.tag ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.tag_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 276 (class 1259 OID 29297)
-- Name: users; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.users (
    id bigint NOT NULL,
    nickname text NOT NULL,
    email text NOT NULL,
    password text NOT NULL,
    role bigint DEFAULT '1'::bigint NOT NULL
);


ALTER TABLE public.users OWNER TO postgres;

--
-- TOC entry 277 (class 1259 OID 29310)
-- Name: users_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.users ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.users_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 3775 (class 0 OID 30012)
-- Dependencies: 283
-- Data for Name: bookmarks; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.bookmarks VALUES (48, 7, 18);
INSERT INTO public.bookmarks VALUES (50, 7, 19);
INSERT INTO public.bookmarks VALUES (51, 9, 18);
INSERT INTO public.bookmarks VALUES (52, 9, 17);
INSERT INTO public.bookmarks VALUES (53, 9, 15);
INSERT INTO public.bookmarks VALUES (54, 10, 18);


--
-- TOC entry 3762 (class 0 OID 29188)
-- Dependencies: 264
-- Data for Name: brand; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.brand VALUES (9, 'Johan & Nyström');
INSERT INTO public.brand VALUES (10, 'Audun Coffee');
INSERT INTO public.brand VALUES (11, 'simplo');
INSERT INTO public.brand VALUES (12, 'Lavazza');


--
-- TOC entry 3764 (class 0 OID 29206)
-- Dependencies: 266
-- Data for Name: coffee; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.coffee VALUES (15, 'Johan & Nyström - Etiopia Guji Filter 250g ', 'Kawa ziarnista jakości specialty pochodząca z Etiopii, wypalona w szwedzkiej palarni Johan & Nyström. Palona w jasnym stopniu, sprawdzi się  do ekspresu przelewowego, dripa, Chemexa, AeroPressa, French Pressa i innych alternatywnych metod parzenia. W filiżance na pierwszy plan wysuwa się słodycz, dopełniona nutami owocowymi. Można tu wyczuć nuty dżemu truskawkowego, jeżyn i arbuza.', '647f84ac2da10.jpg', 9);
INSERT INTO public.coffee VALUES (16, 'Johan & Nyström - Brazil Fortaleza Filter 250g ', 'Kawa ziarnista jakości specialty pochodząca z Brazylii, wypalana przez szwedzką palarnie Johan & Nystrom. Palona jasno, sprawdzi się przede wszystkim w przelewowych metodach parzenia. Fortaleza jest doskonale zbalansowana, o naturalnych nutach czekolady, orzechów laskowych i wiśni - propozycja skierowana do tych, którzy w kawie poszukują naturalnej słodyczy.
', '647f84ea03116.jpg', 9);
INSERT INTO public.coffee VALUES (17, 'Audun Coffee - Brazylia Fazenda Rainha Miaki Filter 250g ', 'Audun Coffee Brazylia Fazenda Rainha Miaki Filter jest to kawa ziarnista jakości specialty pochodząca z Brazylii, wypalona przez Mistrza Świata Roasterów 2015, Auduna Sorbottena. Palarnia Audun Coffee znajduje się w Bydgoszczy i produkuje kawy, które spotkać można w najlepszych kawiarniach w Polsce.', '647f85192b875.jpg', 10);
INSERT INTO public.coffee VALUES (18, 'Johan & Nyström - Etiopia Welena Filter 250g ', 'Kawa ziarnista jakości specialty pochodząca z Etiopii, wypalona w szwedzkiej palarni Johan & Nyström. Palona w jasnym stopniu, sprawdzi się do ekspresu przelewowego, dripa, Chemexa, AeroPressa, French Pressa i innych alternatywnych metod parzenia.', '647f8587aa5b0.jpg', 9);
INSERT INTO public.coffee VALUES (19, 'SIMPLo - Etiopia Ora Filter ', 'Kawa ziarnista jakości speciality pochodząca z Etiopii, wypalona w warszawskiej palarni SIMPLo. Palona jasno, idealna do ekspresu przelewowego, dripa, Chemexa, AeroPressa, French Pressa oraz innych alternatywnych metod parzenia.', '647f86faed2b3.jpg', 11);
INSERT INTO public.coffee VALUES (20, 'Lavazza Qualita Oro', 'Złota jakość (wł. qualita oro) tej kawy bierze się z wyselekcjonowanych ziaren Arabiki sprowadzonych z najlepszych plantacji południowej i centralnej Ameryki oraz Afryki.', '647f871e93bb0.jpg', 12);


--
-- TOC entry 3766 (class 0 OID 29225)
-- Dependencies: 268
-- Data for Name: coffee_tag; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.coffee_tag VALUES (10, 6, 15);
INSERT INTO public.coffee_tag VALUES (11, 6, 18);
INSERT INTO public.coffee_tag VALUES (12, 6, 19);
INSERT INTO public.coffee_tag VALUES (13, 8, 18);
INSERT INTO public.coffee_tag VALUES (14, 7, 17);
INSERT INTO public.coffee_tag VALUES (15, 7, 16);


--
-- TOC entry 3768 (class 0 OID 29251)
-- Dependencies: 271
-- Data for Name: rating; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.rating VALUES (69, 9, 18, 5);
INSERT INTO public.rating VALUES (70, 9, 15, 2);
INSERT INTO public.rating VALUES (71, 9, 17, 5);
INSERT INTO public.rating VALUES (72, 10, 18, 5);
INSERT INTO public.rating VALUES (73, 10, 16, 1);
INSERT INTO public.rating VALUES (74, 10, 20, 1);
INSERT INTO public.rating VALUES (76, 10, 19, 2);
INSERT INTO public.rating VALUES (62, 7, 19, 5);
INSERT INTO public.rating VALUES (68, 7, 18, 2);


--
-- TOC entry 3770 (class 0 OID 29267)
-- Dependencies: 273
-- Data for Name: roles; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.roles VALUES (1, 'user');
INSERT INTO public.roles VALUES (2, 'admin');


--
-- TOC entry 3772 (class 0 OID 29285)
-- Dependencies: 275
-- Data for Name: tag; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.tag VALUES (6, 'Etiopia');
INSERT INTO public.tag VALUES (7, 'Brazylia');
INSERT INTO public.tag VALUES (8, 'Speciality');


--
-- TOC entry 3773 (class 0 OID 29297)
-- Dependencies: 276
-- Data for Name: users; Type: TABLE DATA; Schema: public; Owner: postgres
--

INSERT INTO public.users VALUES (7, 'user1', 'user1@email.com', '$argon2id$v=19$m=65536,t=4,p=1$Si5YOWRTVm9VbXVZbUJ4UA$sAV4CzvUJQLXo/v6I2othr1UBnKRVNlKUdKYipbnP2A', 2);
INSERT INTO public.users VALUES (9, 'user2', 'user2@email.com', '$argon2id$v=19$m=65536,t=4,p=1$WlhKaHR2Zlp5WHVpaDdEYw$dZPheIWDD8GFVBndYEchlx30Lt68dstCALNQFiC3sWw', 1);
INSERT INTO public.users VALUES (10, 'user3', 'user3@email.com', '$argon2id$v=19$m=65536,t=4,p=1$aUl2Q0lUeHJ5SS85M09PRg$R7u7nS69i24G51OoCubJ1JTKjlg4wKfEiq4HO9djMGU', 1);


--
-- TOC entry 3801 (class 0 OID 0)
-- Dependencies: 265
-- Name: brand_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.brand_id_seq', 20, true);


--
-- TOC entry 3802 (class 0 OID 0)
-- Dependencies: 267
-- Name: coffee_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.coffee_id_seq', 42, true);


--
-- TOC entry 3803 (class 0 OID 0)
-- Dependencies: 269
-- Name: coffee_tag_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.coffee_tag_id_seq', 15, true);


--
-- TOC entry 3804 (class 0 OID 0)
-- Dependencies: 272
-- Name: rating_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.rating_id_seq', 77, true);


--
-- TOC entry 3805 (class 0 OID 0)
-- Dependencies: 274
-- Name: roles_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.roles_id_seq', 2, true);


--
-- TOC entry 3806 (class 0 OID 0)
-- Dependencies: 284
-- Name: saved_products_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.saved_products_id_seq', 55, true);


--
-- TOC entry 3807 (class 0 OID 0)
-- Dependencies: 285
-- Name: tag_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.tag_id_seq', 8, true);


--
-- TOC entry 3808 (class 0 OID 0)
-- Dependencies: 277
-- Name: users_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.users_id_seq', 10, true);


--
-- TOC entry 3578 (class 2606 OID 29524)
-- Name: brand brand_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.brand
    ADD CONSTRAINT brand_pkey PRIMARY KEY (id);


--
-- TOC entry 3580 (class 2606 OID 29532)
-- Name: coffee coffee_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.coffee
    ADD CONSTRAINT coffee_pkey PRIMARY KEY (id);


--
-- TOC entry 3582 (class 2606 OID 29540)
-- Name: coffee_tag coffee_tag_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.coffee_tag
    ADD CONSTRAINT coffee_tag_pkey PRIMARY KEY (id);


--
-- TOC entry 3584 (class 2606 OID 29548)
-- Name: rating rating_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.rating
    ADD CONSTRAINT rating_pkey PRIMARY KEY (id);


--
-- TOC entry 3586 (class 2606 OID 29556)
-- Name: roles roles_name_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.roles
    ADD CONSTRAINT roles_name_key UNIQUE (name);


--
-- TOC entry 3588 (class 2606 OID 29564)
-- Name: roles roles_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.roles
    ADD CONSTRAINT roles_pkey PRIMARY KEY (id);


--
-- TOC entry 3594 (class 2606 OID 30020)
-- Name: bookmarks saved_products_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.bookmarks
    ADD CONSTRAINT saved_products_pkey PRIMARY KEY (id);


--
-- TOC entry 3590 (class 2606 OID 29572)
-- Name: tag tag_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.tag
    ADD CONSTRAINT tag_pkey PRIMARY KEY (id);


--
-- TOC entry 3592 (class 2606 OID 29580)
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);


--
-- TOC entry 3751 (class 2618 OID 29244)
-- Name: coffee_view _RETURN; Type: RULE; Schema: public; Owner: postgres
--

CREATE OR REPLACE VIEW public.coffee_view AS
 SELECT coffee.name,
    coffee.description,
    coffee.image_file,
    round(avg(rating.grade), 2) AS rating,
    coffee.id,
    coffee.brand,
    count(rating.rated_coffee) AS review_count
   FROM (public.coffee
     LEFT JOIN public.rating ON ((rating.rated_coffee = coffee.id)))
  GROUP BY coffee.id;


--
-- TOC entry 3601 (class 2606 OID 30036)
-- Name: bookmarks bookmarks_coffee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.bookmarks
    ADD CONSTRAINT bookmarks_coffee_id_fkey FOREIGN KEY (coffee_id) REFERENCES public.coffee(id) ON DELETE CASCADE;


--
-- TOC entry 3602 (class 2606 OID 30031)
-- Name: bookmarks bookmarks_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.bookmarks
    ADD CONSTRAINT bookmarks_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- TOC entry 3595 (class 2606 OID 30042)
-- Name: coffee coffee_brand_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.coffee
    ADD CONSTRAINT coffee_brand_fkey FOREIGN KEY (brand) REFERENCES public.brand(id) ON DELETE RESTRICT;


--
-- TOC entry 3596 (class 2606 OID 29765)
-- Name: coffee_tag coffee_tag_coffee_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.coffee_tag
    ADD CONSTRAINT coffee_tag_coffee_id_fkey FOREIGN KEY (coffee_id) REFERENCES public.coffee(id) ON DELETE CASCADE;


--
-- TOC entry 3597 (class 2606 OID 29776)
-- Name: coffee_tag coffee_tag_tag_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.coffee_tag
    ADD CONSTRAINT coffee_tag_tag_id_fkey FOREIGN KEY (tag_id) REFERENCES public.tag(id) ON DELETE CASCADE;


--
-- TOC entry 3598 (class 2606 OID 29787)
-- Name: rating rating_rated_by_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.rating
    ADD CONSTRAINT rating_rated_by_fkey FOREIGN KEY (rated_by) REFERENCES public.users(id);


--
-- TOC entry 3599 (class 2606 OID 29798)
-- Name: rating rating_rated_coffee_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.rating
    ADD CONSTRAINT rating_rated_coffee_fkey FOREIGN KEY (rated_coffee) REFERENCES public.coffee(id) ON DELETE CASCADE;


--
-- TOC entry 3600 (class 2606 OID 29809)
-- Name: users users_role_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_role_fkey FOREIGN KEY (role) REFERENCES public.roles(id) ON DELETE RESTRICT;